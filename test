SSLContext sslContext = SSLContextBuilder.create()
                .loadTrustMaterial(new TrustAllStrategy())  // Trust all certs
                .build();
        var tlsStrategy = ClientTlsStrategyBuilder.create()
                .setSslContext(sslContext)
                .build();
        var connectionManager = PoolingHttpClientConnectionManagerBuilder.create()
                .setTlsStrategy(tlsStrategy)
                .build();
        CloseableHttpClient httpClient = HttpClients.custom()
                .setConnectionManager(connectionManager)
                .build();
        HttpComponentsClientHttpRequestFactory requestFactory =
                new HttpComponentsClientHttpRequestFactory(httpClient);
        return new RestTemplate(requestFactory);
package com.citi.olympus.config;

import org.apache.hc.client5.http.classic.CloseableHttpClient;
import org.apache.hc.client5.http.impl.classic.HttpClients;
import org.apache.hc.client5.http.ssl.NoopHostnameVerifier;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.web.client.RestTemplate;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
import javax.net.ssl.SSLContext;
import static org.assertj.core.api.Assertions.assertThat;
@SpringBootTest
@ActiveProfiles("local")
class RestTemplateConfigTest {
    @Autowired
    private RestTemplate restTemplate;
    @Autowired
    private RestTemplate restTemplateLocal;
    @Autowired
    private RestTemplateConfig config;
    @Test
    void testDefaultRestTemplateBeanExists() {
        assertThat(restTemplate).isNotNull();
        assertThat(restTemplate.getRequestFactory()).isNotInstanceOf(HttpComponentsClientHttpRequestFactory.class);
    }
    @Test
    void testCustomSslRestTemplateBeanExists() {
        assertThat(restTemplateLocal).isNotNull();
        assertThat(restTemplateLocal.getRequestFactory())
                .isInstanceOf(HttpComponentsClientHttpRequestFactory.class);
    }
    @Test
    void testSslRestTemplateUsesTrustAllStrategy() throws Exception {
        RestTemplate rt = config.restTemplateLocal();

        HttpComponentsClientHttpRequestFactory factory =
                (HttpComponentsClientHttpRequestFactory) rt.getRequestFactory();

        CloseableHttpClient httpClient = (CloseableHttpClient) factory.getHttpClient();

        assertThat(httpClient).isNotNull();
    }
    @Test
    void testBothBeansAreDifferent() {
        assertThat(restTemplate).isNotSameAs(restTemplateLocal);
    }
}
